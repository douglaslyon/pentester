#include <SPI.h>
#include "RF24.h"
//#include "printf.h"   // must include this to use radio.printDetails();
#include "PENTEST_NRF.h"
#include "PENTEST_KEYBOARD.h"

#define CE_PIN 8
#define CSN_PIN 7
#define MAX_LOAD_SIZE 32

RF24 radio(CE_PIN, CSN_PIN);
PENTEST_NRF pentester(&radio);

byte payload[MAX_LOAD_SIZE];


void setup() {
  //printf_begin();          // This is for initializing printf that is used by printDetails()
  Serial.begin(115200);
  radio.begin(); 
  pentester.init(false);  //on receiving end, dont wait for serial 
  radio.setPALevel(RF24_PA_HIGH);           // override the default PA_LOW pentester.init() sets
  Keyboard.begin();   //keyboard and serial do not always play nice
  //radio.printDetails();                   // Dump the configuration of the rf unit for debugging
  //Serial.println("connecting................");
  delay(500);
  radio.startListening();
  setOS('W');  //'W' for windows, 'L' for linux, 'M' for mac. Defaults to windows
}

void loop() {
  if (pentester.rxReliable(payload)) {
    radio.stopListening();
    typeCommands(payload);
    memset(payload, 0, MAX_LOAD_SIZE);
    radio.startListening();
  }
  pentester.checkForRadioFail();
}
