#include <SPI.h>
#include "RF24.h"
//#include "printf.h"   // must include this to use radio.printDetails();
#include "nrfPen.h"
#include "pentestKbd.h"

#define CE_PIN 8
#define CSN_PIN 7

RF24 radio(CE_PIN, CSN_PIN);
nrfPen pentester(&radio);

const int loadSize = 32;
byte payload[loadSize];


void setup() {
  //printf_begin();          // This is for initializing printf that is used by printDetails()
  radio.begin(); 
  pentester.init(false);  //on receiving end, dont wait for serial 
  radio.setPALevel(RF24_PA_HIGH);           // override the default PA_LOW pentester.init() sets

  Serial.begin(115200);
  Keyboard.begin();   //keyboard and serial do not always play nice
  //radio.printDetails();                   // Dump the configuration of the rf unit for debugging
  //Serial.println("connecting................");
  delay(500);
  radio.startListening();
  setOS('W');  //'W' for windows, 'L' for linux, 'M' for mac. Defaults to windows
}

void loop() {
  if (pentester.rxReliable(payload)) {
    radio.stopListening();
    typeCommands(payload);
    memset(payload, 0, loadSize);
    radio.startListening();
  }
}
